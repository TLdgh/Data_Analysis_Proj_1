---
output:
  pdf_document:
    latex_engine: xelatex
  always_allow_html: true
---
```{r}
library(dplyr)
ElectionPoll<-read.csv("polls_us_election_2016.csv", header = TRUE)
head(ElectionPoll)
```

In the second step, we want to look at the percentage of different grades of pollsters. Therefore, we extract the "pollster" and "grade" columns from the original data frame, merge the duplicate rows and re-sort the data according to the grade
```{r}
pollster_grade <- distinct(subset(ElectionPoll, select = c("pollster","grade")))
pollster_grade$grade <- ifelse(is.na(pollster_grade$grade), "none", pollster_grade$grade)
summary_data <- pollster_grade %>%
  group_by(grade, pollster) %>%
  summarise("number of rating" = n(), .groups = 'drop')
summary_data
```

From the "Pie Chart of Grades" below, we could see that the pollsters with B grades account for nearly 50% of the total, C and A grades account for about 30% and 25% respectively. Pollsters rated D only account for less than 1%. Furthermore, grade B and C+ have the largest proportions, at about 17.3%, followed by B+ and B-, both at about 15.1%.

```{r}
category_counts <- table(as.factor(pollster_grade$grade))
unique_levels <- levels(factor(pollster_grade$grade))
percentages <- (category_counts / sum(category_counts))*100 
A <- as.data.frame(percentages)

library(plotly)

piechart <- plot_ly(A, labels=~Var1, values=~Freq, type="pie")
piechart <- piechart %>% layout(title = "Pie Chart of Pollsters' Grades",
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         legend = list(title = list(text="Grade")))

piechart

htmlwidgets::saveWidget(widget = piechart, file = "piechart.html")
webshot::webshot(url = "piechart.html", file = "piechart.png", delay = 1, zoom = 4, vheight = 500)
```