---
title: "Plot"
author: 
  - Teng Li(7373086)
  - Shiya Gao(300381032) 
  - Chuhan Yue(300376046)
  - Yang Lyu(8701121)
output: pdf_document
header-includes: 
  - \renewcommand{\and}{\\}
---

# Introduction
A data set of the 2016 US election polls was given. In this project we aim to understand the data structure by creating various visualizations.  

# Method
We use various R packages to present the data set and to plot the graphs.
```{r, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(plotly)
library(dplyr)
library(tidyverse)
library(ggplot2)
```
# Result
We first take a look at the raw data set:
```{r}
ElectionPoll<-read.csv("polls_us_election_2016.csv", header = TRUE)
```
As we can see, there are a few variables with missing values:
```{r}
summary(ElectionPoll)
```

```{r}
#Create frame contained time, rawpoll
start_time <- as.POSIXct(ElectionPoll$startdate)
end_time <- as.POSIXct(ElectionPoll$enddate)
prop_raw_clinton <- ElectionPoll$rawpoll_clinton
prop_raw_trump <- ElectionPoll$rawpoll_trump
prop_raw_johnson <- ElectionPoll$rawpoll_johnson
prop_raw_mcmullin <- ElectionPoll$rawpoll_mcmullin

poll_by_time <- data.frame( 
  start_time = start_time,
  end_time = end_time,
  clinton = prop_raw_clinton,
  trump = prop_raw_trump,
  johnson = prop_raw_johnson,
  mcmullin = prop_raw_mcmullin
)

head(poll_by_time)
# Order with increasing end_date
poll_by_time <- poll_by_time[order(poll_by_time$end_time, decreasing = FALSE),]
head(poll_by_time)
```
Without removing the missing values:
```{r}
# Plot trend with all four candidates's uncleaned data
ggplot(poll_by_time, aes(x = end_time)) +
  geom_line(aes(y = prop_raw_clinton, color = "Clinton")) +
  geom_line(aes(y = prop_raw_trump, color = "Trump")) +
  geom_line(aes(y = prop_raw_johnson, color = "Johnson")) +
  geom_line(aes(y = prop_raw_mcmullin, color = "Mcmullin")) +
  labs(x = "Date", y = "Proportion of rawpoll") +
  scale_color_manual(values = c("Clinton" = "blue", "Trump" = "red", "Johnson" = "green", "Mcmullin" = "yellow")) +
  scale_x_datetime(date_breaks = "2 month")
  theme_minimal() + ggtitle("Poll Proportion by Time with Missing Values")

```

```{r}
# Plot trend with all four candidates's uncleaned data
ggplot(poll_by_time, aes(x = end_time)) +
  geom_smooth(aes(y = prop_raw_clinton, color = "Clinton")) +
  geom_smooth(aes(y = prop_raw_trump, color = "Trump")) +
  geom_smooth(aes(y = prop_raw_johnson, color = "Johnson")) +
  geom_smooth(aes(y = prop_raw_mcmullin, color = "Mcmullin")) +
  labs(x = "Date", y = "Proportion of rawpoll") +
  scale_color_manual(values = c("Clinton" = "blue", "Trump" = "red", "Johnson" = "green", "Mcmullin" = "yellow")) +
  scale_x_datetime(date_breaks = "2 month")
  theme_minimal() + ggtitle("Average Poll Proportion by Time (with Missing Values)")

```

Remove the missing values:
```{r}
#Remove the missing values
poll_by_time_clean <- na.omit(poll_by_time)
# Count the row number of 4 candidates cleaned data
nrow(poll_by_time_clean)

start_time_clean <- as.POSIXct(poll_by_time_clean$start_time)
end_time_clean <- as.POSIXct(poll_by_time_clean$end_time)
prop_raw_clinton_clean <- poll_by_time_clean$clinton
prop_raw_trump_clean <- poll_by_time_clean$trump
prop_raw_johnson_clean <- poll_by_time_clean$johnson
prop_raw_mcmullin_clean <- poll_by_time_clean$mcmullin
```
Using the data with missing values deleted, a trend chart showing the change in the proportion of votes obtained by all four candidates over time is made.
```{r}
ggplot(poll_by_time_clean, aes(x = end_time_clean)) +
  geom_line(aes(y = prop_raw_clinton_clean, color = "Clinton")) +
  geom_line(aes(y = prop_raw_trump_clean, color = "Trump")) +
  geom_line(aes(y = prop_raw_johnson_clean, color = "Johnson")) +
  geom_line(aes(y = prop_raw_mcmullin_clean, color = "Mcmullin")) +
  labs(x = "Date", y = "Proportion of rawpoll") +
  scale_color_manual(values = c("Clinton" = "blue", "Trump" = "red", "Johnson" = "green", "Mcmullin" = "yellow")) +
  theme_minimal() + ggtitle("Poll Proportion by Time (without Missing Values)")
```

3 candidate's (Clinton, Trump and Johnson) trend by time with cleaned data.
```{r}
#Create 3 candidates frame contained time, rawpoll
poll_by_time_3 <- data.frame( 
  start_time = start_time,
  end_time = end_time,
  clinton = prop_raw_clinton,
  trump = prop_raw_trump,
  johnson = prop_raw_johnson
)

print(poll_by_time_3)
```

3 candidates data removing the missing values:
```{r}
# Remove the missing values
poll_by_time_clean_3 <- na.omit(poll_by_time_3)
head(poll_by_time_clean_3)
# Ordered by end_data
poll_by_time_clean_3 <- poll_by_time_clean_3[order(poll_by_time_clean_3$end_time, decreasing = FALSE),]
head(poll_by_time_clean_3)
# Count the number of row for cleaned 3 candidates data
nrow(poll_by_time_clean_3)

start_time_clean_3 <- as.POSIXct(poll_by_time_clean_3$start_time)
end_time_clean_3 <- as.POSIXct(poll_by_time_clean_3$end_time)
prop_raw_clinton_clean_3 <- poll_by_time_clean_3$clinton
prop_raw_trump_clean_3 <- poll_by_time_clean_3$trump
prop_raw_johnson_clean_3 <- poll_by_time_clean_3$johnson
```

Using the data with missing values deleted, a trend chart showing the change in the proportion of votes obtained by 3 candidates (Clinton, Trump and Johnson) over time is made.
```{r}
ggplot(poll_by_time_clean_3, aes(x = end_time_clean_3)) +
  geom_smooth(aes(y = prop_raw_clinton_clean_3, color = "Clinton")) +
  geom_smooth(aes(y = prop_raw_trump_clean_3, color = "Trump")) +
  geom_smooth(aes(y = prop_raw_johnson_clean_3, color = "Johnson")) +
  labs(x = "Date", y = "Proportion of rawpoll") +
  scale_color_manual(values = c("Clinton" = "blue", "Trump" = "red", "Johnson" = "green")) +
  scale_x_datetime(date_breaks = "1 month")
  theme_minimal() + ggtitle("Clinton vs. Trump vs. Johnson Average Poll Proportion by Time (without Missing Values)")
```

2 candidate's (Clinton, Trump) trend by time with cleaned data.
```{r}
#Create 2 candidates frame contained time, rawpoll
poll_by_time_2 <- data.frame( 
  start_time = start_time,
  end_time = end_time,
  clinton = prop_raw_clinton,
  trump = prop_raw_trump
)

print(poll_by_time_2)
```

2 candidates data removing the missing values:
```{r}
# Remove the missing values
poll_by_time_clean_2 <- na.omit(poll_by_time_2)
head(poll_by_time_clean_2)
# Ordered by end_data
poll_by_time_clean_2 <- poll_by_time_clean_2[order(poll_by_time_clean_2$end_time, decreasing = FALSE),]
head(poll_by_time_clean_2)
tail(poll_by_time_clean_2)
# Count the number of row for cleaned 2 candidates data
nrow(poll_by_time_clean_2)

start_time_clean_2 <- as.POSIXct(poll_by_time_clean_2$start_time)
end_time_clean_2 <- as.POSIXct(poll_by_time_clean_2$end_time)
prop_raw_clinton_clean_2 <- poll_by_time_clean_2$clinton
prop_raw_trump_clean_2 <- poll_by_time_clean_2$trump
```

Using the data with missing values deleted, a trend chart showing the change in the proportion of votes obtained by 2 candidates (Clinton vs. Trump) over time is made.
```{r}
ggplot(poll_by_time_clean_2, aes(x = end_time_clean_2)) +
  geom_smooth(aes(y = prop_raw_clinton_clean_2, color = "Clinton")) +
  geom_smooth(aes(y = prop_raw_trump_clean_2, color = "Trump")) +
  labs(x = "Date", y = "Proportion of rawpoll") +
  scale_color_manual(values = c("Clinton" = "blue", "Trump" = "red")) +
  scale_x_datetime(date_breaks = "2 month")
  theme_minimal() + ggtitle("Clinton vs. Trump Poll Average Proportion by Time (without Missing Values)")
```
